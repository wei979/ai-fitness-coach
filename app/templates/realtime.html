<!DOCTYPE html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>健身冒險 - 即時偵測</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/realtime.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/continuous-defense-mode.css') }}">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
        <!-- 添加 GLTFLoader -->
        <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>   
        <!-- 引入 OrbitControls (可選) -->
        <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
        <!-- 引入訓練計劃處理模塊 -->
        <script src="{{ url_for('static', filename='js/student-manager.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/config.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/utils.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/combo.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/workout-plan-manager.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/detection-manager.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/basketball-manager.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/game.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/quest-handler.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/exercise-options.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/stop-detection-manager.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/attack-effects.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/attack-combo-system.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/monster-position-controller.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/socket-manager.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/continuous-defense-mode.js') }}"></script>
        <script src="{{ url_for('static', filename='js/modules/main-app.js') }}"></script>
        <script src="{{ url_for('static', filename='js/workout_handler.js') }}"></script>
        <!-- 最後引入主要邏輯 -->
        <script src="{{ url_for('static', filename='js/realtime.js') }}"></script>
    </head>
<body>
    <!-- 頁面載入動畫 -->
    <div class="page-loader" id="page-loader">
        <div class="loader-content">
            <div class="loader-title">健身冒險</div>
            <div class="loader-subtitle">正在進入第 <span id="current-level">1</span> 關</div>
            
            <div class="loader-progress">
                <div class="loader-progress-bar" id="loader-progress-bar"></div>
            </div>
            
            <div class="loader-level-info">
                <div class="loader-level-image">
                    <img src="/static/img/levels/level1.png" alt="關卡圖片" id="level-image">
                </div>
                <div class="loader-level-details">
                    <div class="loader-level-name" id="level-name">森林入口</div>
                    <div class="loader-level-description" id="level-description">初始關卡，適合新手挑戰。完成基本運動來獲得經驗值。</div>
                    <div class="loader-level-monsters" id="level-monsters">怪物：小型史萊姆 x3</div>
                </div>
            </div>
            
            <div class="loader-tips">提示：保持正確姿勢可以獲得更高的品質評分和額外經驗值！</div>
        </div>
    </div>

    <!-- 頭部導航 -->
    <header class="header">
        <div class="logo-container">
            <img src="/static/img/nkust.png" alt="健身冒險">
            <span>健身冒險</span>
        </div>
        
        <div class="user-info">
            <div class="user-avatar">
                <img src="/static/img/avatar.png" alt="用戶頭像">
            </div>
            <div class="user-stats">
                <div class="username">{{ current_user.username }}</div>
                <div class="level-info">等級 <span id="user-level">1</span></div>
            </div>
            <div class="exp-progress-container">
                <div class="exp-label">經驗值: <span id="current-exp">0</span>/<span id="next-level-exp">100</span></div>
                <div class="exp-bar">
                    <div class="exp-bar-fill" id="exp-bar-fill"></div>
                </div>
                <div class="simple-map">
                    <div class="map-hint">點擊關卡可直接選擇</div>
                    <div class="map-scroll-container" id="map-scroll-container">
                        <div class="map-levels">
                            <div class="map-level-item">
                                <div class="map-level-dot completed">
                                    <i class="fas fa-tree"></i>
                                </div>
                                <div class="map-level-label">森林</div>
                            </div>
                            <div class="map-level-item">
                                <div class="map-level-dot active">
                                    <i class="fas fa-mountain"></i>
                                </div>
                                <div class="map-level-label">山脈</div>
                            </div>
                            <div class="map-level-item">
                                <div class="map-level-dot">
                                    <i class="fas fa-water"></i>
                                </div>
                                <div class="map-level-label">湖泊</div>
                            </div>
                            <div class="map-level-item">
                                <div class="map-level-dot">
                                    <i class="fas fa-dungeon"></i>
                                </div>
                                <div class="map-level-label">洞窟</div>
                            </div>
                            <div class="map-level-item">
                                <div class="map-level-dot">
                                    <i class="fas fa-dragon"></i>
                                </div>
                                <div class="map-level-label">龍巢</div>
                            </div>
                        </div>
                    </div>
                    <div class="map-controls">
                        <button class="map-scroll-btn" id="scroll-left-btn"><i class="fas fa-chevron-left"></i></button>
                        <button class="small-button" id="show-map-btn">查看完整地圖</button>
                        <button class="map-scroll-btn" id="scroll-right-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="nav-buttons">
            <a href="{{ url_for('exercise.taekwondo_detail') }}" class="button primary">
                <i class="fas fa-fist-raised"></i> 跆拳道詳細分析
            </a>
            <a href="/" class="button">返回首頁</a>
            <a href="/achievements" class="button secondary">成就</a>
            <a href="/profile" class="button accent">個人檔案</a>
        </div>
    </header>

    <div class="content">
        <div class="main-content-area">
            <!-- 視頻區域  -->
            <div class="video-container">
                <img src="" alt="等待開始偵測..." id="video-feed">
                <div class="video-overlay">
                    <div class="video-top-bar">
                        <div class="detection-status" id="detection-status">準備中</div>
                        <!-- 玩家生命條 - 置於視頻中間上方 -->
                        <div class="video-player-status" id="video-player-status">
                            <div class="video-hp-container">
                                <div class="video-hp-label">生命值</div>
                                <div class="video-hp-bar">
                                    <div class="video-player-hp-bar" id="video-player-hp-bar"></div>
                                </div>
                                <div class="video-hp-value"><span id="video-player-hp">100</span>/<span id="video-player-max-hp">100</span>/<span id="video-player-total-hp">100</span></div>
                            </div>
                            <div class="video-shield-container">
                                <div class="video-shield-label">護盾值</div>
                                <div class="video-shield-bar">
                                    <div class="video-shield-bar-fill" id="video-player-shield-bar"></div>
                                </div>
                                <div class="video-shield-value"><span id="video-player-shield">0</span>/<span id="video-player-max-shield">50</span>/<span id="video-player-total-shield">50</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="video-bottom-bar">
                        <div class="exercise-info">
                            <div class="exercise-name">剩餘組數: <span id="remaining-sets">0</span></div>
                        </div>
                    </div>
                </div>
                <!-- 攻擊特效畫布 -->
                <canvas id="attack-effects-canvas"></canvas>
            </div>
            
            <!-- 怪物和教練提示 -->
            <div class="right-side-panel">
                <!-- 玩家狀態面板 - 隱藏，因為已移至視頻內 -->
                <div class="player-status-panel" id="player-status-panel" style="display: none;">
                    <div class="player-status-header">
                        <div class="player-title">
                            <i class="fas fa-user-shield"></i>
                            <span>玩家狀態</span>
                        </div>
                    </div>
                    <div class="player-status-body">
                        <!-- 玩家血量 -->
                        <div class="hp-container">
                            <div class="hp-label">生命值</div>
                            <div class="hp-bar">
                                <div class="player-hp-bar" id="player-hp-bar"></div>
                            </div>
                            <div class="hp-value"><span id="player-hp">100</span>/<span id="player-max-hp">100</span></div>
                        </div>
                        
                        <!-- 玩家護盾 -->
                        <div class="shield-container">
                            <div class="shield-label">護盾值</div>
                            <div class="shield-bar">
                                <div class="shield-bar-fill" id="player-shield-bar"></div>
                            </div>
                            <div class="shield-value"><span id="player-shield">0</span>/<span id="player-max-shield">50</span></div>
                        </div>
                        
                        <!-- 防禦進度 -->
                        <div class="defense-container" id="defense-container" style="display: none;">
                            <div class="defense-label">防禦進度</div>
                            <div class="defense-progress-bar">
                                <div class="defense-progress-fill" id="defense-progress-fill"></div>
                            </div>
                            <div class="defense-instruction" id="defense-instruction">維持深蹲姿勢激活護盾</div>
                        </div>
                    </div>
                </div>
                
                <!-- 怪物區域 -->
                <div class="monster-area">
                    <div class="hp-container">
                        <div class="hp-label">怪物血量:</div>
                        <div class="hp-bar">
                            <div class="hp-bar-fill" id="monster-hp-bar"></div>
                        </div>
                        <div class="hp-value"><span id="monster-hp">100</span>/<span id="monster-max-hp">100</span></div>
                    </div>
                    
                    <div class="hp-container">
                        <div class="hp-label">怪物護盾:</div>
                        <div class="hp-bar">
                            <div class="hp-bar-fill shield-bar-fill" id="monster-shield-bar"></div>
                        </div>
                        <div class="hp-value">
                            護盾值: <span id="shield-value">0</span> | 
                            權重: <span id="shield-weight">1.0</span> | 
                            <span id="monster-shield">0</span>/<span id="monster-max-shield">0</span>
                        </div>
                    </div>
        
                    <div class="monster-container" id="monster-container">
                        <div class="monster-scene-container" id="monster-scene">
                            <!-- 3D怪物將由JavaScript渲染 -->
                        </div>
                    </div>
                </div>
                
                <!-- 教練提示區域 - 移到怪物區域下方 -->
                <div class="coach-tip-container">
                    <div class="coach-tip-header">
                        <div class="coach-title">教練提示</div>
                        <div class="quality-display">
                            <div class="quality-title">未評分</div>
                            <div class="quality-score-container">
                                <span id="quality-score">0</span>/5
                            </div>
                        </div>
                    </div>
                    <div class="coach-tip-content">
                        <div class="coach-tip-text" id="coach-tip-text">
                            請選擇運動類型並開始偵測以獲得即時建議。
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Combo技能顯示區域 -->
        <div class="combo-skill-container">
            <div class="combo-header">
                <div class="combo-title"><i class="fas fa-bolt"></i> 連招技能</div>
                <div class="combo-counter">連擊: <span id="combo-count">0</span></div>
            </div>
            <div class="combo-body">
                <div class="combo-slots">
                    <div class="combo-slot" id="combo-slot-1">
                        <div class="combo-slot-empty"><i class="fas fa-plus"></i></div>
                    </div>
                    <div class="combo-slot" id="combo-slot-2">
                        <div class="combo-slot-empty"><i class="fas fa-plus"></i></div>
                    </div>
                    <div class="combo-slot" id="combo-slot-3">
                        <div class="combo-slot-empty"><i class="fas fa-plus"></i></div>
                    </div>
                    <div class="combo-skill-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="combo-skill-result" id="combo-skill-result">
                        <div class="combo-skill-empty">技能未觸發</div>
                    </div>
                </div>
                <div class="combo-description" id="combo-description">
                    完成特定動作組合可以觸發強力技能！
                </div>
            </div>
        </div>
        
        <div class="bottom-content-area">
            <!-- 運動設定區域 - 調整寬度 -->
            <div class="data-container compact">
                <div class="data-header">
                    <div class="data-title">運動設定</div>
                    <div class="data-subtitle">選擇運動類型和設定目標</div>
                </div>
                <div class="data-body">
                    <!-- 內容保持不變 -->
                    <form id="workout-form" class="data-inputs">
                                                             
                        

                        <!-- 訓練計劃表單區域 -->
                        <div class="workout-plan-container">
                            <h3 class="plan-title">訓練計劃</h3>
                            
                            <!-- 在學號輸入區域添加必填標識 -->
                            <div class="student-info-container">
                                <div class="input-group">
                                    <label for="student-id-input">學號 <span class="required">*</span></label>
                                    <input type="text" id="student-id-input" name="student_id" placeholder="請輸入學號" required>
                                    <div class="input-hint">開始訓練前必須輸入學號</div>
                                </div>
                                
                                <!-- 攝像頭索引選擇器 -->
                                <div class="input-group">
                                    <label for="camera-index-input">攝像頭索引</label>
                                    <select id="camera-index-input" name="camera_index">
                                        <option value="0" selected>攝像頭 0 (預設)</option>
                                        <option value="1">攝像頭 1</option>
                                        <option value="2">攝像頭 2</option>
                                        <option value="3">攝像頭 3</option>
                                        <option value="4">攝像頭 4</option>
                                        <option value="5">攝像頭 5</option>
                                        <option value="6">攝像頭 6</option>
                                        <option value="7">攝像頭 7</option>
                                        <option value="8">攝像頭 8</option>
                                        <option value="9">攝像頭 9</option>
                                        <option value="10">攝像頭 10</option>

                                    </select>
                                    <div class="input-hint">選擇要使用的攝像頭索引，通常預設為 0</div>
                                </div>
                            </div>
                            
                            <div id="workout-exercises" class="workout-exercises">
                                <!-- 預設的第一個運動項目 -->
                                <div class="workout-exercise-item" data-index="0">
                                    <div class="exercise-item-header">
                                        <span class="exercise-number">1</span>
                                        <button type="button" class="remove-exercise-btn" title="移除此運動"><i class="fas fa-times"></i></button>
                                    </div>
                                    <div class="exercise-item-body">
                                        <div class="input-group">
                                            <label for="exercise-type">運動類型</label>
                                            <select id="exercise-type" name="exercise-type[]" class="exercise-selector" required>
                                                <!-- 運動選項將由 exercise-options.js 動態填充 -->
                                            </select>
                                        </div>
                                        <div class="exercise-params">
                                            <div class="input-group">
                                                <label for="weight">重量 (kg)</label>
                                                <input type="number" id="weight" name="weight[]" placeholder="0" min="0" max="200" value="0">
                                            </div>
                                            <div class="input-group">
                                                <label for="reps">次數/組</label>
                                                <input type="number" id="reps" name="reps[]" placeholder="10" min="1" max="100" value="10" required>
                                            </div>
                                            <div class="input-group">
                                                <label for="sets">組數</label>
                                                <input type="number" id="sets" name="sets[]" placeholder="3" min="1" max="10" value="3" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="workout-plan-actions">
                                <button type="button" id="add-exercise-btn" class="button secondary">
                                    <i class="fas fa-plus"></i> 添加運動
                                </button>
                                <button type="submit" id="save-workout-plan" class="button primary">
                                    <i class="fas fa-save"></i> 儲存計劃
                                </button>
                            </div>
                        </div>
                        
                        <!-- 訓練計劃摘要 -->
                        <div class="workout-plan-summary" id="workout-plan-summary">
                            <h3>當前訓練計劃</h3>
                            <div id="current-plan-display">
                                <div class="no-plan">尚未設定訓練計劃</div>
                            </div>
                            <div class="current-exercise-info">
                                <div class="current-exercise-label">當前運動:</div>
                                <div id="current-plan-exercise">-</div>
                                <div class="progress-info">
                                    <span id="current-exercise-progress">0/0</span> 次
                                    (<span id="current-exercise-sets">0/0</span> 組)
                                </div>
                            </div>
                        </div>
                        
                        <!-- 特定運動控制元素保持不變 -->
                        <div id="basketball-controls" class="exercise-specific-controls" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    籃球投籃控制
                                </div>
                                <div class="card-body">
                                    <button type="button" id="reset-basketball" class="btn btn-warning">重置檢測</button>
                                    <p class="mt-2">請將手放入對應的圓圈中保持3秒來確定慣用手，然後按照指示完成投籃動作。</p>                                   
                                </div>
                            </div>
                        </div>
                        
                        <!-- 添加籃球運球控制元素 -->
                        <div id="basketball-dribble-controls" class="exercise-specific-controls" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    籃球運球控制
                                </div>
                                <div class="card-body">
                                    <button type="button" id="reset-basketball-dribble" class="btn btn-warning">重置檢測</button>
                                    <p class="mt-2">請將手放入對應的圓圈中保持3秒來確定慣用手，然後按照指示完成運球動作。</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 添加籃球運球模式顯示區域 -->
                        <div id="dribble-mode-container" class="exercise-info-panel" style="display: none;">
                            <div class="info-panel-header">
                                <i class="fas fa-basketball-ball"></i>
                                <span>運球模式</span>
                            </div>
                            <div class="info-panel-content">
                                <div class="dribble-mode-display">
                                    <span>當前模式: </span>
                                    <span id="current-dribble-mode">高位運球</span>
                                </div>
                                <div class="dribble-mode-description">
                                    <p id="dribble-mode-description">高位運球模式：保持手腕在膝蓋以上位置運球</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 添加排球高手攻擊控制元素 -->
                        <div id="volleyball-overhand-controls" class="exercise-specific-controls" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    排球高手攻擊控制
                                </div>
                                <div class="card-body">
                                    <button type="button" id="reset-volleyball-overhand" class="btn btn-warning">重置檢測</button>
                                    <p class="mt-2">請保持正確的高手攻擊姿勢，將手腕抬高至頭部以上位置進行攻擊動作。</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 添加排球低手接球控制元素 -->
                        <div id="volleyball-lowhand-controls" class="exercise-specific-controls" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    排球低手接球控制
                                </div>
                                <div class="card-body">
                                    <button type="button" id="reset-volleyball-lowhand" class="btn btn-warning">重置檢測</button>
                                    <p class="mt-2">請保持正確的低手接球姿勢，雙手在腰部以下位置準備接球。</p>
                                    <div class="volleyball-lowhand-info">
                                        <div class="posture-timer">
                                            <span>正確姿勢時間: </span>
                                            <span id="volleyball-posture-time">0</span>/<span id="volleyball-target-time">30</span> 秒
                                        </div>
                                        <div class="posture-status">
                                            <span>姿勢狀態: </span>
                                            <span id="volleyball-posture-status">等待檢測</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 添加雙手輪流擺動熱身控制元素 -->
                        <div id="alternating-arm-swing-controls" class="exercise-specific-controls" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-dumbbell"></i>
                                    <span id="arm-swing-header-text">雙手輪流擺動熱身控制</span>
                                </div>
                                <div class="card-body">
                                    <!-- 動態內容容器 -->
                                    <div id="arm-swing-dynamic-content">
                                        <!-- 預設為普通訓練模式內容，將由 JavaScript 動態替換 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 添加平板支撐控制元素 -->
                        <div id="plank-controls" class="exercise-specific-controls" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-stopwatch"></i>
                                    <span id="plank-header-text">平板支撐控制</span>
                                </div>
                                <div class="card-body">
                                    <!-- 動態內容容器 -->
                                    <div id="plank-dynamic-content">
                                        <!-- 預設為普通訓練模式內容，將由 JavaScript 動態替換 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    
                    <div class="control-stats-panel">
                        <div class="exercise-counter">
                            <div class="counter-label">運動次數</div>
                            <div class="counter-value" id="exercise-count">0</div>
                        </div>
                        
                        <div class="control-panel">
                            <button class="button" id="start-detection">開始偵測</button>
                            <button class="button secondary" id="stop-detection" disabled>停止偵測</button>
                            <button class="button accent" id="reset-count">重置計數</button>
                            <button type="button" onclick="window.location.href='/exercise/picture'" class="button info large">
                                <i class="fas fa-camera"></i> 檢查投籃動作
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            

        </div>
        
        <div class="bottom-stats-container">
            <div class="stats-card">
                <div class="stats-label">總運動次數</div>
                <div class="stats-value" id="exercise-count-stats">0</div>
            </div>
            <div class="stats-card">
                <div class="stats-label">消耗熱量</div>
                <div class="stats-value" id="calories-burned">0</div>
            </div>
            <div class="stats-card">
                <div class="stats-label">運動時間</div>
                <div class="stats-value" id="exercise-time">00:00</div>
            </div>
            <button class="export-button" id="export-excel">匯出數據</button>
        </div>
    </div>
    




    
    <!-- 地圖模態視窗 -->
    <div class="modal" id="map-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>冒險地圖</h2>
                <div class="close-modal" id="close-map-modal">&times;</div>
            </div>
            <div class="modal-body">
                <div class="map-hint centered">點擊關卡可直接選擇</div>
                <div class="full-map-container">
                    <div class="full-map-scroll-container" id="full-map-scroll-container">
                        <div class="full-map-levels">
                            <div class="full-map-level-item">
                                <div class="level-node completed">
                                    <i class="fas fa-tree"></i>
                                    <span>1</span>
                                </div>
                                <div class="level-path"></div>
                                <div class="level-name">森林入口</div>
                                <div class="level-description">初始關卡，適合新手挑戰</div>
                            </div>
                            <div class="full-map-level-item">
                                <div class="level-node active">
                                    <i class="fas fa-mountain"></i>
                                    <span>2</span>
                                </div>
                                <div class="level-path"></div>
                                <div class="level-name">山脈地帶</div>
                                <div class="level-description">中級難度，需要更多力量</div>
                            </div>
                            <div class="full-map-level-item">
                                <div class="level-node">
                                    <i class="fas fa-water"></i>
                                    <span>3</span>
                                </div>
                                <div class="level-path"></div>
                                <div class="level-name">神秘湖泊</div>
                                <div class="level-description">需要耐力與平衡</div>
                            </div>
                            <div class="full-map-level-item">
                                <div class="level-node">
                                    <i class="fas fa-dungeon"></i>
                                    <span>4</span>
                                </div>
                                <div class="level-path"></div>
                                <div class="level-name">古老洞窟</div>
                                <div class="level-description">高難度，需要全面技能</div>
                            </div>
                            <div class="full-map-level-item">
                                <div class="level-node">
                                    <i class="fas fa-dragon"></i>
                                    <span>5</span>
                                </div>
                                <div class="level-name">龍之巢穴</div>
                                <div class="level-description">最終挑戰，考驗極限</div>
                            </div>
                        </div>
                    </div>
                    <div class="full-map-controls">
                        <button class="map-scroll-btn large" id="full-scroll-left-btn"><i class="fas fa-chevron-left"></i></button>
                        <button class="map-scroll-btn large" id="full-scroll-right-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="button secondary" id="close-map-btn">關閉</button>
                <button class="button" id="start-level-btn">開始挑戰</button>
            </div>
        </div>
    </div>
    
    <!-- 成就通知 -->
    <div class="achievement-notification" id="achievement-notification">
        <div class="achievement-icon">🏆</div>
        <div class="achievement-text">
            <h3 id="notification-title">成就解鎖！</h3>
            <p id="notification-description">你已完成一項新成就</p>
        </div>
    </div>
    
    <!-- 訓練計劃表單模態視窗 -->
    <div class="modal" id="workout-plan-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>訓練計劃設定</h2>
                <div class="close-modal" id="close-workout-plan-modal">&times;</div>
            </div>
            <div class="modal-body">
                <div class="plan-description">
                    設定您的訓練計劃，可以添加多個運動動作及其目標次數。完成一個動作後，系統會自動切換到下一個動作。
                </div>
                
                <div class="workout-plan-list" id="workout-plan-list">
                    <!-- 訓練計劃項目將在這裡動態添加 -->
                </div>
                
                <button class="button secondary" id="add-exercise-btn">
                    <i class="fas fa-plus"></i> 添加運動
                </button>
            </div>
            <div class="modal-footer">
                <button class="button secondary" id="cancel-plan-btn">取消</button>
                <button class="button" id="save-plan-btn">保存計劃</button>
            </div>
        </div>
    </div>

    <!-- 籃球投籃檢視提示視窗 -->
    <div class="modal" id="basketball-prompt-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>籃球投籃姿勢檢視</h2>
                <div class="close-modal" id="close-basketball-prompt-modal">&times;</div>
            </div>
            <div class="modal-body">
                <div class="basketball-prompt-description">
                    恭喜完成籃球投籃訓練！您想要查看您的投籃姿勢分析嗎？
                </div>
                <div class="basketball-prompt-image">
                    <img src="/static/img/basketball_posture.png" alt="籃球投籃姿勢示意圖">
                </div>
            </div>
            <div class="modal-footer">
                <button class="button secondary" id="skip-basketball-btn">稍後再說</button>
                <button class="button primary" id="view-basketball-btn">立即查看</button>
            </div>
        </div>
    </div>


    <!-- 休息提示模態視窗 -->
    <div class="modal" id="rest-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>休息時間</h2>
            </div>
            <div class="modal-body">
                <div class="rest-timer-container">
                    <div class="rest-timer" id="rest-timer">30</div>
                    <div class="rest-timer-label">秒</div>
                </div>
                <div class="next-exercise-info">
                    <h3>下一個運動</h3>
                    <div class="next-exercise-details">
                        <div class="next-exercise-icon" id="next-exercise-icon">
                            <i class="fas fa-dumbbell"></i>
                        </div>
                        <div class="next-exercise-text">
                            <div class="next-exercise-name" id="next-exercise-name">二頭彎舉</div>
                            <div class="next-exercise-target" id="next-exercise-target">10次 x 3組</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="button" id="skip-rest-btn">跳過休息</button>
            </div>
        </div>
    </div>
    
    <!-- 攻擊警告界面 -->
    <div class="attack-warning" id="attack-warning">
        <div class="warning-content">
            <div class="warning-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="warning-text">
                <div class="warning-title">怪物即將攻擊！</div>
                <div class="warning-subtitle">快速進入防禦姿勢</div>
            </div>
            <div class="warning-timer" id="warning-timer">8</div>
        </div>
    </div>
    
    <!-- 死亡界面 -->
    <div class="death-screen" id="death-screen" style="display: none;">
        <div class="death-content">
            <div class="death-title">遊戲結束</div>
            <div class="death-subtitle">你被怪物擊敗了！</div>
            <div class="death-actions">
                <button class="button primary" id="respawn-btn">重新開始</button>
                <button class="button secondary" id="quit-btn">退出遊戲</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/realtime.js') }}"></script>

    <script>
        // 頁面載入動畫
        document.addEventListener('DOMContentLoaded', function() {
            const pageLoader = document.getElementById('page-loader');
            const progressBar = document.getElementById('loader-progress-bar');
            
            // 模擬載入進度
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                progressBar.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        pageLoader.classList.add('fade-out');
                        setTimeout(() => {
                            pageLoader.style.display = 'none';
                        }, 500);
                    }, 500);
                }
            }, 100);
            
            // 設置地圖模態視窗事件
            const mapModal = document.getElementById('map-modal');
            const showMapBtn = document.getElementById('show-map-btn');
            const closeMapBtn = document.getElementById('close-map-btn');
            const closeMapModalBtn = document.getElementById('close-map-modal');
            const startLevelBtn = document.getElementById('start-level-btn');
            
            showMapBtn.addEventListener('click', () => {
                mapModal.classList.add('active');
            });
            
            closeMapBtn.addEventListener('click', () => {
                mapModal.classList.remove('active');
            });
            
            closeMapModalBtn.addEventListener('click', () => {
                mapModal.classList.remove('active');
            });

            startLevelBtn.addEventListener('click', () => {
                mapModal.classList.remove('active');
                // 在此處添加開始挑戰的邏輯
            });
        });
    </script>
</body>