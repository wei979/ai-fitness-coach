# 跆拳道詳細姿態偵測模式功能開發計畫

## 1. 功能概述

在現有健身冒險應用中新增一個「詳細姿態偵測模式」功能。此模式將提供更深入的跆拳道動作分析，包括：

- **大畫面影像顯示**：提供清晰的即時影像回饋。
- **即時角度資訊**：顯示關節角度，如膝蓋、手肘、髖部等。
- **物理數據分析**：計算並顯示角速度、角加速度等物理量，幫助選手精確分析動作。

## 2. 開發步驟與檔案規劃

### 2.1 前端部分

**目標**：創建一個新的頁面來顯示詳細姿態偵測模式的介面，並在 `realtime.html` 中添加一個按鈕來導航到此頁面。

**檔案新增/修改**：

- **修改 `d:/Fiting_Web/web_lab/app/templates/realtime.html`**：
    - 添加一個按鈕，用於跳轉到新的詳細姿態偵測頁面。

- **新增 `d:/Fiting_Web/web_lab/app/templates/taekwondo_detail.html`**：
    - 包含大畫面影像顯示區域。
    - 顯示角度資訊的UI元素。
    - 顯示物理分析數據（角速度、角加速度等）的UI元素。
    - 可能需要圖表來視覺化數據。

- **新增 `d:/Fiting_Web/web_lab/static/js/modules/taekwondo_detail_manager.js`**：
    - 處理 `taekwondo_detail.html` 頁面的前端邏輯。
    - 負責從後端接收數據並更新UI。
    - 可能包含數據視覺化的邏輯（如使用Chart.js）。

- **新增 `d:/Fiting_Web/web_lab/static/css/taekwondo_detail.css`**：
    - 定義 `taekwondo_detail.html` 頁面的樣式。

### 2.2 後端部分

**目標**：創建新的後端路由和服務，用於處理跆拳道詳細姿態偵測的邏輯，包括接收影像、進行姿態分析、計算物理數據並將結果發送回前端。

**檔案新增/修改**：

- **修改 `d:/Fiting_Web/web_lab/app/routes/exercise_routes.py`**：
    - 添加一個新的路由，用於渲染 `taekwondo_detail.html` 頁面。
    - 添加一個新的API端點，用於接收前端的影像串流並返回詳細分析數據。

- **新增 `d:/Fiting_Web/web_lab/app/services/taekwondo_service.py`**：
    - 包含跆拳道姿態檢測的核心邏輯。
    - 利用現有的姿態檢測模型（如YOLOv8n-pose）來獲取關鍵點。
    - 實現角度計算、角速度、角加速度等物理量的計算邏輯。
    - 可能需要定義跆拳道特定動作的判斷邏輯。

- **修改 `d:/Fiting_Web/web_lab/app/services/exercise_service.py`**：
    - 引入 `taekwondo_service.py`。
    - 可能需要調整 `process_frame_realtime` 或創建新的處理函數來整合跆拳道模式。

- **修改 `d:/Fiting_Web/web_lab/app/__init__.py`**：
    - 註冊新的藍圖（如果為跆拳道功能創建獨立藍圖）。
    - 確保 `taekwondo_service` 中的模型能夠被正確初始化。

## 3. 技術細節與考量

- **姿態檢測模型**：繼續使用YOLOv8n-pose進行關鍵點檢測。
- **數據傳輸**：使用WebSocket (Socket.IO) 進行即時影像串流和分析數據的傳輸。
- **物理量計算**：
    - **角度**：基於關鍵點坐標計算關節角度。
    - **角速度**：通過連續幀的角度變化率計算。
    - **角加速度**：通過連續幀的角速度變化率計算。
    - 需要考慮平滑處理以減少噪聲。
- **性能優化**：確保即時處理的性能，可能需要考慮多線程或異步處理。
- **UI/UX**：設計清晰直觀的介面，方便用戶查看和理解複雜的數據。

## 4. 測試計畫

- **單元測試**：測試 `taekwondo_service.py` 中的各個計算函數的準確性。
- **整合測試**：測試前後端數據傳輸和處理流程的完整性。
- **功能測試**：驗證詳細姿態偵測模式的各項功能是否按預期工作。
- **性能測試**：評估系統在即時處理大量數據時的響應速度和穩定性。

## 5. 預期成果

- 一個獨立的詳細姿態偵測頁面。
- 能夠即時顯示跆拳道動作的關節角度和物理分析數據。
- 為跆拳道選手提供量化的訓練反饋，幫助他們改進技術。

## 6. 後續擴展

- 動作識別與評分：基於詳細數據自動識別跆拳道動作並給出專業評分。
- 歷史數據記錄與回放：保存訓練數據，供選手回顧和比較。
- 3D姿態重建：將2D關鍵點轉換為3D姿態，提供更直觀的視角。